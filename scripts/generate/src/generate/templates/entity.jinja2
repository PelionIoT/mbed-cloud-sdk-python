"""
Entity module

This file is autogenerated from api specifications
"""

# Python 2 compatibility
from __future__ import unicode_literals
from builtins import str  # noqa
from builtins import super

from mbed_cloud.sdk.common.entity import Entity
from mbed_cloud.sdk.common import fields
from mbed_cloud.sdk import enums

{% for entity in entities %}


class {{ entity._key|to_pascal }}(Entity):
    """Represents the `{{entity._key|to_pascal}}` entity in Mbed Cloud"""

    # all fields available on this entity
    _fieldnames = [
        {% for field in entity.fields %}
        '{{field._key|to_snake}}',
        {% endfor %}
    ]

    # common renames used when mapping {% raw %}{<API spec>: <SDK>}{% endraw %}
    _renames = {
        {% for rename in entity.field_renames %}
        '{{rename.api_fieldname}}': '{{rename._key|to_snake}}',
        {% endfor %}
    }

    def __init__(
        self, _client=None{% if entity.fields %},{% endif %}
        {% for field in entity.fields if not field.private_field %}
            {{field._key|to_snake}}=None,
        {% endfor %}
    ):
        """Creates a local `{{entity._key|to_pascal}}` instance

        {% for field in entity.fields if not field.private_field %}:param {{field._key|to_snake}}: {{ (field.description or '')|wordwrap(width=66)|indent(width=12) }}
        :type {{field._key|to_snake}}: {{field.python_type}}
        {% endfor %}"""

        super().__init__(_client=_client)

        # inline imports for avoiding circular references and bulk imports
        {% for field in entity.fields %}{% set fkey = (field.foreign_key or (field['items'] and field['items'].foreign_key)) %}{% if fkey and fkey.entity != entity._key%}
        from mbed_cloud.sdk._modules.{{ fkey.group|to_snake }}.{{ fkey.entity|to_snake }} import {{ fkey.entity|to_pascal }}{% endif %}{% endfor %}

        # fields
        {% for field in entity.fields %}self._{{field._key|to_snake}} = fields.{{field.python_field}}(
            value={{'None' if field.private_field else field._key|to_snake}}
            {% if field.enum_reference %}
            , enum=enums.{{ field.enum_reference|to_pascal }}
            {% endif %}
            {% set fkey = field.foreign_key or (field['items'] and field['items'].foreign_key) %}{% if fkey %}
            , entity={{ fkey.entity|to_pascal }}
            {% endif %}
        )
        {% endfor %}

    {% for field in entity.fields if not field.private_field%}
    @property
    def {{field._key|to_snake}}(self):
        """{{ (field.description or '')|wordwrap(width=78)|indent(width=8) }}
        {% if field.example %}
        api example: {{ field.example|repr|wordwrap(width=78)|indent(width=12) }}
        {% endif %}
        :rtype: {{ field.python_type }}{% if field['items'] and field['items'].foreign_key %}[{{ field['items'].foreign_key.entity|to_pascal }}]{% endif %}{% if field.foreign_key %}[{{ field.foreign_key.entity|to_pascal }}]{% endif %}
        """
        {% if field.getter_custom_method %}
        from mbed_cloud.sdk.common._custom_methods import {{ field.getter_custom_method }}
        return {{ field.getter_custom_method }}(self=self, field=self._{{field._key|to_snake}})
        {% else %}
        return self._{{field._key|to_snake}}.value
        {% endif %}
    {% if not field.read_only and not field=='id' %}
    @{{ field._key|to_snake }}.setter
    def {{field._key|to_snake}}(self, value):
        """Set value of `{{ field._key|to_snake }}`

        :param value: value to set
        :type value: {{ field.python_type }}{% if field['items'] and field['items'].foreign_key %}[{{ field['items'].foreign_key.entity|to_pascal }}]{% endif %}{% if field.foreign_key %}[{{ field.foreign_key.entity|to_pascal }}]{% endif %}
        """
        {% if field.setter_custom_method %}
        from mbed_cloud.sdk.common._custom_methods import {{ field.setter_custom_method }}
        {{ field.setter_custom_method }}(self=self, field=self._{{field._key|to_snake}}, value=value)
        {% else %}
        self._{{field._key|to_snake}}.set(value)
        {% endif %}
    {% endif %}
    {% endfor %}

    {% for method in entity.methods|sort(attribute='_key') %}
    {# Determine the return type of the method, it may be a paginated response, the entity itself of a foreign key #}
    {% set return_type = method.python_return_type %}
    {% if method.pagination %}
        {% set unpack_type = false %}
        {% set foreign_key_import = false %}
        {% if not return_type %}
            {% set return_type = "mbed_cloud.pagination." + "PaginatedResponse" %}
        {% else %}
            {% set return_type = "mbed_cloud.pagination." + return_type %}
        {% endif %}
    {% elif method.return_info.self %}
        {% set unpack_type = "self" %}
        {% set foreign_key_import = false %}
    {% else %}
        {% set unpack_type = return_type %}
        {% set foreign_key_import = true %}

    {% endif %}
    def {% if method.private_method %}_{% endif %}{{method._key|to_snake}}(
        {% if method.pagination and method.custom_method %}
            self, include=None, max_results=None, page_size=None, order=None
        {% else %}
            self
            {% for field in method.fields|sort_parg_kwarg %}
                {% if field.external_param %},
                    {% if field.required %}
                        {{field._key|to_snake}}
                    {% else %}
                        {{field._key|to_snake}}={{ field.default|repr }}
                    {% endif %}
                {% endif %}
            {% endfor %}
        {% endif %}
        ):
        """{{method.summary}}

        {% if method.path %}api documentation:
        https://os.mbed.com/search/?q=service+apis+{{ method.path }}{% endif %}
        {%- if method.pagination and method.custom_method %}
        {% for field in method.fields if field._key != "after" %}{% if field.external_param %}
        {%- if field._key == "limit" %}
        :param max_results: Total maximum number of results to retrieve
        :type max_results: int
            {% set field_name = "page_size" %}
        {%- else %}
            {%- set field_name = field._key|to_snake %}
        {%- endif %}
        :param {{field_name}}: {{ (field.description or field.foreign_key.entity|to_pascal)|wordwrap(width=70)|indent(width=12) }}
        :type {{field_name}}: {{ (field.foreign_key and 'mbed_cloud.sdk.' + field.foreign_key.entity|to_pascal) or field.python_type}}
        {% endif %}{% endfor %}
        :return: An iterator object which yields instances of an entity.
        {%- else %}
        {% for field in method.fields %}{% if field.external_param %}
        :param {{field._key|to_snake}}: {{ (field.description or field.foreign_key.entity|to_pascal)|wordwrap(width=70)|indent(width=12) }}
        :type {{field._key|to_snake}}: {{ (field.foreign_key and 'mbed_cloud.sdk.' + field.foreign_key.entity|to_pascal) or field.python_type}}
        {% endif %}{% endfor %}
        {%- endif %}
        :rtype: {{ return_type }}
        """
    {% for field in method.fields %}
        {% if field.set_foreign_key_properties %}
            {% for set_on_other, set_from_self in field.set_foreign_key_properties.items() %}
        {{field.entity_fieldname}}.{{ set_on_other }} = self.{{ set_from_self }}
            {% endfor %}
        {% endif %}
    {% endfor %}
    {% if method.defer_to_foreign_key_field %}
        return {{ method.defer_to_foreign_key_field.field }}.{{ method.defer_to_foreign_key_field.method }}()
    {% elif method.custom_method %}
        from mbed_cloud.sdk.common._custom_methods import {{ method.custom_method }}
        {% if method.foreign_key %}from mbed_cloud.sdk.entities import {{ method.foreign_key.entity|to_pascal }}{% endif %}

        return {{ method.custom_method }}(
            self=self,
            foreign_key={% if method.foreign_key %}{{ method.foreign_key.entity|to_pascal }}{% else %}self.__class__{% endif %}
            {% if method.pagination %}
            , include=include
            , max_results=max_results
            , page_size=page_size
            , order=order
            {% else %}
                {% for field in method.fields|pargs_kwargs %}
                    {% if field.external_param %},
                        {{field._key|to_snake}}={{field._key|to_snake}}
                    {% endif %}
                {% endfor %}
            {% endif %}
            {% if method.pagination %},wraps=self._{{ method.paginate_target }}{% endif %}
        )
    {% else %}
        {% if foreign_key_import %}from mbed_cloud.sdk.entities import {{ return_type }}{% endif %}
        return self._client.call_api(
            method='{{method.method}}',
            path='{{ method.path }}',
            {% for param_in, count in method.python_params_in.items() %}
                {% if count %}
                {{ param_in }}_params = {% if not method.__REPLACE_BODY or param_in != 'body' %}{% raw %}{{% endraw %}{% endif %}
                    {% for field in method.fields %}
                    {% if field['in'] == param_in %}
                    {% if not method.__REPLACE_BODY or param_in != 'body' %}
                        '{{field.parameter_fieldname}}':
                    {% endif %}
                        {% if field.external_param %}
                            fields.{{ field.python_field }}({{field._key|to_snake}}{% if field.enum_reference %}, enum=enums.{{ field.enum_reference|to_pascal }}{% endif %}).to_api()
                        {% else %}
                            self._{{field._key|to_snake}}.to_api()
                        {% endif %}
                    {% if not method.__REPLACE_BODY or param_in != 'body' %},{% endif %}
                    {% endif %}
                    {% endfor %}
                {% if not method.__REPLACE_BODY or param_in != 'body' %}{% raw %}}{% endraw %}{% endif %},
                {% endif %}
            {% endfor %}
            unpack = {{ unpack_type }},
        )
    {% endif %}
    {% endfor %}
{% endfor %}
