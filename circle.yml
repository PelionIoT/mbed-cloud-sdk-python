machine:
  services:
    - docker

general:
  artifacts:
    - results

dependencies:
  override:
    - sudo apt-get update
    - sudo apt-get install pandoc
    - pip install awscli codecov
    # AWS and docker and circleci do not get along well:
    # for safety, try both ways of assigning credentials
    - |
      login="$(aws ecr get-login)"
      ${login}
      login="$(aws ecr get-login --no-include-email)"
      ${login}
    - docker pull $TESTRUNNER_DOCKER_IMAGE
    - pip install tox tox-pyenv
    - pyenv local 2.7.12 3.6.2

test:
  override:
    - tox
  post:
    # upload to codecov.io
    - codecov

deployment:
  production:
    branch: master
    commands:
      - ./generate-docs.sh
